<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Route Planner</title>
    <style>
        :root{--bg:#0f172a;--panel:#101826;--muted:#9aa4b2;--line:rgba(255,255,255,.08);--text:#e6ebf2;--accent:#3cc6e0}
        *{box-sizing:border-box}
        body{margin:0;background:linear-gradient(135deg,#0f172a,#0b1120 55%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial}
        .wrap{max-width:980px;margin:36px auto;padding:0 16px}
        .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:16px}
        .title{margin:0 0 6px;font-size:22px}
        .sub{color:var(--muted);font-size:13px;margin:2px 0 0}
        .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;margin-top:12px}
        .section h2{font-size:16px;margin:0 0 10px}
        .row{display:flex;gap:10px;flex-wrap:wrap}
        .field{flex:1;min-width:180px;display:flex;flex-direction:column;gap:6px}
        label{font-size:12px;color:var(--muted)}
        input,select{background:#0b1220;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:10px 12px}
        button{border:0;background:var(--accent);color:#06141a;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
        button.ghost{background:transparent;color:var(--text);border:1px solid var(--line)}
        .list{margin-top:10px;border-top:1px dashed var(--line);padding-top:8px;max-height:240px;overflow:auto;font-size:14px}
        .pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;margin:2px;font-size:12px}
        table{width:100%;border-collapse:collapse;font-size:14px}
        th,td{padding:8px;border-bottom:1px solid var(--line);text-align:left}
        .out{white-space:pre-wrap;background:#0b1220;border:1px dashed var(--line);padding:12px;border-radius:10px;margin-top:10px;min-height:56px}
        .hint{color:var(--muted);font-size:12px;margin-top:6px}
        .ok{color:#38d39f}.bad{color:#ff7272}
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <h1 class="title">Route Planner</h1>
        <p class="sub">Add cities and roads, then compute the shortest path between two points. In-memory storage (no DB).</p>
    </div>

    <div class="grid">
        <div class="card section">
            <h2>Add City</h2>
            <div class="row">
                <div class="field">
                    <label>City name</label>
                    <input id="cityName" placeholder="e.g., pune">
                </div>
                <div class="field" style="align-self:flex-end">
                    <button id="addCityBtn">Add City</button>
                </div>
            </div>

            <h2 style="margin-top:16px">Add Road</h2>
            <div class="row">
                <div class="field"><label>From</label><input id="srcRoad"></div>
                <div class="field"><label>To</label><input id="destRoad"></div>
                <div class="field"><label>Distance (km)</label><input id="kmRoad" type="number" min="1"></div>
                <div class="field" style="align-self:flex-end"><button id="addRoadBtn">Add Road</button></div>
            </div>

            <h2 style="margin-top:16px">Shortest Path</h2>
            <div class="row">
                <div class="field"><label>Source</label><select id="srcFind"></select></div>
                <div class="field"><label>Destination</label><select id="destFind"></select></div>
                <div class="field" style="align-self:flex-end"><button id="findBtn">Find</button></div>
            </div>

            <div id="result" class="out">Result will appear here.</div>
        </div>

        <div class="card section">
            <h2>Network (Backend)</h2>
            <div class="list" id="cities"></div>
            <div class="list" style="margin-top:8px">
                <table><thead><tr><th>From</th><th>To</th><th>Km</th></tr></thead><tbody id="roads"></tbody></table>
            </div>
            <div class="row" style="margin-top:8px">
                <span id="apiStatus" class="hint"></span>
            </div>
        </div>
    </div>
</div>

<script>
    // FIXED: auto-detect server; fallback if opened via file://
    const API_BASE = location.origin.startsWith('file') ? 'http://localhost:8080' : location.origin;

    const $ = id => document.getElementById(id);

    async function refreshGraph(){
      try{
        const res = await fetch(`${API_BASE}/api/graph`);
        if(!res.ok) throw new Error();
        const data = await res.json();
        $('apiStatus').innerHTML = '<span class="ok">Backend reachable</span>';

        const cities = Object.keys(data).sort();
        $('cities').innerHTML = cities.map(c=>`<span class="pill">${cap(c)}</span>`).join('') || '<span class="hint">No cities yet.</span>';

        const opts = cities.map(c=>`<option value="${c}">${cap(c)}</option>`).join('');
        $('srcFind').innerHTML = '<option value="">—</option>'+opts;
        $('destFind').innerHTML = '<option value="">—</option>'+opts;

        const rows = [];
        cities.forEach(c => {
          (data[c]||[]).forEach(e => rows.push(`<tr><td>${cap(c)}</td><td>${cap(e.to)}</td><td>${e.distance}</td></tr>`));
        });
        $('roads').innerHTML = rows.join('') || '<tr><td colspan="3"><span class="hint">No roads yet.</span></td></tr>';
      }catch{
        $('apiStatus').innerHTML = '<span class="bad">Backend not reachable</span>';
      }
    }

    function cap(s){ return s ? s[0].toUpperCase()+s.slice(1) : s; }

    $('addCityBtn').onclick = async () => {
      const name = $('cityName').value.trim();
      if(!name){ $('result').textContent='Enter a city name.'; return; }
      await fetch(`${API_BASE}/api/add-city?name=${encodeURIComponent(name)}`, { method:'POST' });
      $('cityName').value='';
      $('result').textContent='City added.';
      refreshGraph();
    };

    $('addRoadBtn').onclick = async () => {
      const s = $('srcRoad').value.trim();
      const d = $('destRoad').value.trim();
      const km = parseInt(($('kmRoad').value||'').trim(),10);
      if(!s || !d || !(km>0)){ $('result').textContent='Enter valid from, to and distance (>0).'; return; }
      await fetch(`${API_BASE}/api/add-road?from=${encodeURIComponent(s)}&to=${encodeURIComponent(d)}&distance=${km}`, { method:'POST' });
      $('srcRoad').value=''; $('destRoad').value=''; $('kmRoad').value='';
      $('result').textContent='Road added.';
      refreshGraph();
    };

    $('findBtn').onclick = async () => {
      const s = $('srcFind').value, d = $('destFind').value;
      if(!s || !d){ $('result').textContent='Select source and destination.'; return; }
      const res = await fetch(`${API_BASE}/api/shortest?src=${encodeURIComponent(s)}&dest=${encodeURIComponent(d)}`);
      const data = await res.json();
      $('result').textContent = (data && data.distance >= 0)
        ? `Path: ${data.path.map(cap).join(' → ')}\nTotal distance: ${data.distance} km`
        : 'No route found.';
    };

    refreshGraph();
</script>
</body>
</html>
