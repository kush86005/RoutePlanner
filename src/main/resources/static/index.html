<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Route Planner</title>
    <style>
        :root{
          --bg:#0f172a;--panel:#101826;--muted:#9aa4b2;--line:rgba(255,255,255,.08);--text:#e6ebf2;--accent:#3cc6e0
        }
        *{box-sizing:border-box}
        body{margin:0;background:linear-gradient(135deg,#0f172a,#0b1120 55%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial}
        .wrap{max-width:980px;margin:36px auto;padding:0 16px}
        .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:16px}
        .title{margin:0 0 6px;font-size:22px}
        .sub{color:var(--muted);font-size:13px;margin:2px 0 0}
        .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;margin-top:12px}
        .section h2{font-size:16px;margin:0 0 10px}
        .row{display:flex;gap:10px;flex-wrap:wrap}
        .field{flex:1;min-width:180px;display:flex;flex-direction:column;gap:6px}
        label{font-size:12px;color:var(--muted)}
        input,select{background:#0b1220;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:10px 12px}
        button{border:0;background:var(--accent);color:#06141a;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
        button.ghost{background:transparent;color:var(--text);border:1px solid var(--line)}
        .list{margin-top:10px;border-top:1px dashed var(--line);padding-top:8px;max-height:240px;overflow:auto;font-size:14px}
        .pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;margin:2px;font-size:12px}
        table{width:100%;border-collapse:collapse;font-size:14px}
        th,td{padding:8px;border-bottom:1px solid var(--line);text-align:left}
        .out{white-space:pre-wrap;background:#0b1220;border:1px dashed var(--line);padding:12px;border-radius:10px;margin-top:10px;min-height:56px}
        .hint{color:var(--muted);font-size:12px;margin-top:6px}
        .ok{color:#38d39f}.bad{color:#ff7272}
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <h1 class="title">Route Planner</h1>
        <p class="sub">Add cities and roads (with distance in km), then compute the shortest path between two points. Static UI (no DB). Backend: Spring Boot.</p>
    </div>

    <div class="grid">
        <div class="card section">
            <h2>Add City</h2>
            <div class="row">
                <div class="field">
                    <label for="cityName">City name</label>
                    <input id="cityName" placeholder="e.g., pune">
                </div>
                <div class="field" style="align-self:flex-end">
                    <button id="addCityBtn">Add City</button>
                </div>
            </div>

            <h2 style="margin-top:16px">Add Road</h2>
            <div class="row">
                <div class="field">
                    <label for="srcRoad">From</label>
                    <input id="srcRoad" placeholder="e.g., pune">
                </div>
                <div class="field">
                    <label for="destRoad">To</label>
                    <input id="destRoad" placeholder="e.g., mumbai">
                </div>
                <div class="field">
                    <label for="kmRoad">Distance (km)</label>
                    <input id="kmRoad" type="number" min="1" placeholder="e.g., 150">
                </div>
                <div class="field" style="align-self:flex-end">
                    <button id="addRoadBtn">Add Road</button>
                </div>
            </div>
            <div class="hint">City names are case-insensitive. Roads are undirected.</div>

            <h2 style="margin-top:16px">Shortest Path</h2>
            <div class="row">
                <div class="field">
                    <label for="srcFind">Source</label>
                    <select id="srcFind"></select>
                </div>
                <div class="field">
                    <label for="destFind">Destination</label>
                    <select id="destFind"></select>
                </div>
                <div class="field" style="align-self:flex-end">
                    <button id="findBtn">Find</button>
                </div>
            </div>
            <div id="result" class="out">Result will appear here.</div>
        </div>

        <div class="card section">
            <h2>Network</h2>
            <div class="list" id="cities"></div>
            <div class="list" style="margin-top:8px">
                <table>
                    <thead><tr><th>From</th><th>To</th><th>Distance (km)</th></tr></thead>
                    <tbody id="roads"></tbody>
                </table>
            </div>
            <div class="row" style="margin-top:8px">
                <button class="ghost" id="seedBtn">Seed Example</button>
                <button class="ghost" id="resetBtn">Reset</button>
                <span id="apiStatus" class="hint"></span>
            </div>
        </div>
    </div>
</div>

<script>
    // point this to your deployed backend (changeable)
    const API_BASE = "https://route-planner-production-19ab.up.railway.app";

    // local state (front-end only; resets on refresh)
    const state = { cities: new Set(), roads: [] };

    const $ = (id) => document.getElementById(id);
    const cityName=$('cityName'), srcRoad=$('srcRoad'), destRoad=$('destRoad'), kmRoad=$('kmRoad');
    const srcFind=$('srcFind'), destFind=$('destFind');
    const addCityBtn=$('addCityBtn'), addRoadBtn=$('addRoadBtn'), findBtn=$('findBtn');
    const seedBtn=$('seedBtn'), resetBtn=$('resetBtn');
    const citiesDiv=$('cities'), roadsTbody=$('roads'), result=$('result'), apiStatus=$('apiStatus');

    function cap(s){return s? s[0].toUpperCase()+s.slice(1):s;}

    function render(){
      // dropdowns
      const opts=[...state.cities].sort().map(c=>`<option value="${c}">${cap(c)}</option>`).join('');
      srcFind.innerHTML = '<option value="">—</option>' + opts;
      destFind.innerHTML = '<option value="">—</option>' + opts;

      // city chips
      citiesDiv.innerHTML = [...state.cities].sort().map(c=>`<span class="pill">${cap(c)}</span>`).join('') || '<span class="hint">No cities yet.</span>';

      // roads table
      roadsTbody.innerHTML = state.roads.map(r=>`<tr><td>${cap(r.src)}</td><td>${cap(r.dest)}</td><td>${r.km}</td></tr>`).join('') || `<tr><td colspan="3"><span class="hint">No roads yet.</span></td></tr>`;
    }

    addCityBtn.onclick = () => {
      const name=(cityName.value||'').trim().toLowerCase();
      if(!name){result.textContent='Enter a city name.';return;}
      if(state.cities.has(name)){result.textContent='City already exists.';return;}
      state.cities.add(name);
      cityName.value='';
      render();
      result.textContent='City added.';
    };

    addRoadBtn.onclick = () => {
      const s=(srcRoad.value||'').trim().toLowerCase();
      const d=(destRoad.value||'').trim().toLowerCase();
      const km=parseInt(kmRoad.value,10);
      if(!s||!d||!(km>0)){result.textContent='Enter valid from, to, and distance (>0).';return;}
      if(s===d){result.textContent='Source and destination must differ.';return;}
      state.cities.add(s); state.cities.add(d);
      // avoid duplicates (undirected)
      const key = (a,b)=> a<b? a+'#'+b : b+'#'+a;
      const k=key(s,d);
      if(state.roads.some(r=>key(r.src,r.dest)===k)){result.textContent='Road already exists.';render();return;}
      state.roads.push({src:s,dest:d,km});
      srcRoad.value=''; destRoad.value=''; kmRoad.value='';
      render();
      result.textContent='Road added.';
    };

    findBtn.onclick = async () => {
      const s=srcFind.value, d=destFind.value;
      if(!s||!d){result.textContent='Select source and destination.';return;}
      try{
        const res = await fetch(`${API_BASE}/api/shortest?src=${encodeURIComponent(s)}&dest=${encodeURIComponent(d)}`);
        if(!res.ok){result.textContent='Server error.';return;}
        const data = await res.json();
        if(!data.path || !Array.isArray(data.path) || data.distance==null || data.distance<0){
          result.textContent='No route found or city missing on server.';
          return;
        }
        result.innerHTML = `Path: ${data.path.join(' → ')}\nTotal distance: ${data.distance} km`;
      }catch(e){
        result.textContent='Could not reach backend.';
      }
    };

    seedBtn.onclick = () => {
      const cities=['pune','mumbai','nashik','delhi','agra','jaipur'];
      cities.forEach(c=>state.cities.add(c));
      const rds=[
        {src:'pune',dest:'mumbai',km:150},
        {src:'pune',dest:'nashik',km:200},
        {src:'mumbai',dest:'nashik',km:180},
        {src:'delhi',dest:'agra',km:233},
        {src:'agra',dest:'jaipur',km:238},
        {src:'delhi',dest:'jaipur',km:281}
      ];
      const has=(a,b)=> state.roads.some(r=> (r.src===a&&r.dest===b)||(r.src===b&&r.dest===a) );
      rds.forEach(r=>{ if(!has(r.src,r.dest)) state.roads.push(r); });
      render();
      result.textContent='Sample data added.';
    };

    resetBtn.onclick = () => {
      state.cities.clear(); state.roads.length=0;
      render();
      result.textContent='Cleared.';
    };

    // backend reachability indicator (optional)
    (async function ping(){
      try{
        const r = await fetch(`${API_BASE}/api/graph`, {method:'GET'});
        apiStatus.innerHTML = r.ok ? '<span class="ok">Backend reachable</span>' : '<span class="bad">Backend not reachable</span>';
      }catch{ apiStatus.innerHTML = '<span class="bad">Backend not reachable</span>'; }
    })();

    render();
</script>
</body>
</html>
